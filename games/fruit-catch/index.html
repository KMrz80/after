<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≤–µ—Ü –§—Ä—É–∫—Ç–æ–≤: –ò–≥—Ä–∞ –∏ –¢–µ—Å—Ç</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∏–≥—Ä—ã */
        #game-area {
            position: relative;
            background: linear-gradient(to bottom, #87CEEB, #A6E3F7); /* –ù–µ–±–æ */
            overflow: hidden;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            touch-action: none; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–∫—Ä—É—Ç–∫—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã */
        }

        .fruit {
            position: absolute;
            font-size: 3rem; /* –ö—Ä—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –¥–µ—Ç–µ–π */
            transition: opacity 0.3s;
            line-height: 1; /* –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤–æ–∫—Ä—É–≥ —ç–º–æ–¥–∑–∏ */
        }

        .basket {
            position: absolute;
            bottom: 0;
            width: 120px;
            height: 80px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="%23a0522d" d="M480 96H32l16 32h432zM32 128l-16 32h480l-16-32zM32 160l-16 32h480l-16-32zM32 192l-16 32h480l-16-32zM32 224l-16 32h480l-16-32zM32 256l-16 32h480l-16-32zM32 288l-16 32h480l-16-32zM32 320l-16 32h480l-16-32zM32 352l-16 32h480l-16-32zM32 384l-16 32h480l-16-32zM32 416l-16 32h480l-16-32zM32 448l-16 32h480l-16-32zM32 480l-16 32h480l-16-32z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            z-index: 10;
        }

        .basket-inner {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20px; /* –í–∏–∑—É–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –¥–ª—è —É–ª–∞–≤–ª–∏–≤–∞–Ω–∏—è */
            background-color: transparent;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∞–Ω–∏–º–∞—Ü–∏—è */
        .modal-overlay {
            z-index: 50;
            backdrop-filter: blur(5px);
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .quiz-button {
            transition: all 0.1s ease;
        }
        .quiz-button:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–±–µ–¥—ã (—Ñ–µ–π–µ—Ä–≤–µ—Ä–∫) */
        .win-screen {
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
        }
        .firework {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(white, gold, orange);
            border-radius: 50%;
            animation: explode 0.5s ease-out forwards;
            opacity: 0;
        }
        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(3); opacity: 0.8; }
            100% { transform: scale(1); opacity: 0; }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#4F46E5',
                        'catch-green': '#10B981',
                        'miss-red': '#EF4444',
                        'basket-brown': '#A0522D',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4 font-sans">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –≤–≤–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <div class="w-full max-w-2xl mb-4 bg-white p-4 rounded-xl shadow-lg">
        <h1 class="text-3xl font-bold text-center text-primary-blue mb-2">–õ–æ–≤–µ—Ü –§—Ä—É–∫—Ç–æ–≤ üçé</h1>
        <p class="text-center text-gray-600 mb-4">–ü–æ–π–º–∞–π—Ç–µ 50 —Ñ—Ä—É–∫—Ç–æ–≤ –∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞—Ç—å!</p>
        
        <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Å–≤–æ–∏—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫ -->
        <div id="image-input-area" class="space-y-2 text-sm">
            <label class="block text-gray-700 font-semibold">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –§—Ä—É–∫—Ç–æ–≤ (URL-–∞–¥—Ä–µ—Å–∞, –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —ç–º–æ–¥–∑–∏):</label>
            <div class="grid grid-cols-2 gap-2 md:grid-cols-4">
                <!-- –í–°–¢–ê–í–õ–Ø–ô–¢–ï –í–ê–®–ò URL-–ê–î–†–ï–°–ê –°–Æ–î–ê -->
                <input type="url" id="img-apple" placeholder="URL –¥–ª—è –Ø–±–ª–æ–∫–∞ üçé" value="https://i.postimg.cc/CzQVRy3z/apple.png" class="p-2 border rounded-lg focus:ring-2 focus:ring-catch-green transition">
                <input type="url" id="img-banana" placeholder="URL –¥–ª—è –ë–∞–Ω–∞–Ω–∞ üçå" value="https://i.postimg.cc/BX60ZZV6/banana.png" class="p-2 border rounded-lg focus:ring-2 focus:ring-catch-green transition">
                <input type="url" id="img-cherry" placeholder="URL –¥–ª—è –í–∏—à–Ω–∏ üçí" value="https://i.postimg.cc/qz5dNfP6/cherry.png" class="p-2 border rounded-lg focus:ring-2 focus:ring-catch-green transition">
                <input type="url" id="img-strawberry" placeholder="URL –¥–ª—è –ö–ª—É–±–Ω–∏–∫–∏ üçì" value="https://i.postimg.cc/MvTSZZFy/strawberry.png" class="p-2 border rounded-lg focus:ring-2 focus:ring-catch-green transition">
                <!-- –í–°–¢–ê–í–õ–Ø–ô–¢–ï –í–ê–®–ò URL-–ê–î–†–ï–°–ê –°–Æ–î–ê -->
            </div>
            <p class="text-xs text-gray-500">–ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–º–æ–¥–∑–∏.</p>
        </div>
    </div>

    <!-- –û–±–ª–∞—Å—Ç—å –∏–≥—Ä—ã -->
    <div id="game-container" class="w-full max-w-2xl aspect-square">
        <div id="game-area" class="w-full h-full relative">
            <!-- –î–∏—Å–ø–ª–µ–π —Å—á–µ—Ç–∞ –∏ –∂–∏–∑–Ω–µ–π -->
            <div class="absolute top-4 left-4 p-3 bg-white/90 rounded-xl shadow-lg text-lg font-bold text-gray-800 flex flex-col space-y-1 z-20">
                <span id="score-display" class="text-catch-green">–°—á–µ—Ç: 0</span>
                <span id="lives-display" class="text-miss-red">–ñ–∏–∑–Ω–∏: 3</span>
            </div>

            <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
            <div id="basket" class="basket">
                <div class="basket-inner"></div>
            </div>

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (–°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
            <div id="quiz-modal" class="modal-overlay fixed inset-0 flex items-center justify-center hidden">
                <div class="bg-white p-8 rounded-xl shadow-2xl w-11/12 max-w-lg transform transition-all duration-300 scale-100">
                    <h2 class="text-2xl font-bold mb-4 text-primary-blue">–í—Ä–µ–º—è –í–∏–∫—Ç–æ—Ä–∏–Ω—ã! üß†</h2>
                    <p id="quiz-question" class="text-xl mb-6 text-gray-800"></p>
                    <div id="quiz-options" class="space-y-3">
                        <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
            
            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥—ã/–ø—Ä–æ–∏–≥—Ä—ã—à–∞ (–°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
            <div id="win-lose-modal" class="win-screen fixed inset-0 flex items-center justify-center hidden">
                <div class="p-10 text-center rounded-xl shadow-2xl w-11/12 max-w-xl bg-white/95 backdrop-blur-sm">
                    <h2 id="modal-title" class="text-4xl font-extrabold mb-4 text-yellow-600"></h2>
                    <p id="modal-message" class="text-xl text-gray-700 mb-6"></p>
                    <button id="restart-button" class="bg-primary-blue hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300">
                        –ù–∞—á–∞—Ç—å –°–Ω–∞—á–∞–ª–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ===
        const GAME_WIDTH = 640;
        const GAME_HEIGHT = 640;
        const BASKET_SPEED = 10;
        // –ù–∏–∂–µ –¥–≤–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è —Ñ—Ä—É–∫—Ç–æ–≤:
        const FALL_SPEED_MIN = 0.8; // –£–º–µ–Ω—å—à–µ–Ω–æ, —á—Ç–æ–±—ã —Ñ—Ä—É–∫—Ç—ã –ø–∞–¥–∞–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
        const FALL_SPEED_MAX = 2.0; // –£–º–µ–Ω—å—à–µ–Ω–æ, —á—Ç–æ–±—ã —Ñ—Ä—É–∫—Ç—ã –ø–∞–¥–∞–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
        const FRUIT_SPAWN_RATE = 1000; // –º—Å

        // === –≠–õ–ï–ú–ï–ù–¢–´ DOM ===
        const gameArea = document.getElementById('game-area');
        const basket = document.getElementById('basket');
        const scoreDisplay = document.getElementById('score-display');
        const livesDisplay = document.getElementById('lives-display');
        const quizModal = document.getElementById('quiz-modal');
        const quizQuestionEl = document.getElementById('quiz-question');
        const quizOptionsEl = document.getElementById('quiz-options');
        const winLoseModal = document.getElementById('win-lose-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const restartButton = document.getElementById('restart-button');
        const imageInputs = {
            apple: document.getElementById('img-apple'),
            banana: document.getElementById('img-banana'),
            cherry: document.getElementById('img-cherry'),
            strawberry: document.getElementById('img-strawberry')
        };

        // === –ü–ï–†–ï–ú–ï–ù–ù–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø –ò–ì–†–´ ===
        let score = 0;
        let lives = 3;
        let basketX = GAME_WIDTH / 2 - 60; // –¶–µ–Ω—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã
        let isGamePaused = false;
        let fruits = [];
        let lastFruitTime = 0;
        let animationFrameId;
        let currentQuizIndex = 0;
        let isGameOver = false;

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã –≤ –ø–∏–∫—Å–µ–ª—è—Ö
        let currentWidth = gameArea.offsetWidth;
        let currentHeight = gameArea.offsetHeight;
        let scaleFactor = currentWidth / GAME_WIDTH;

        // === –î–ê–ù–ù–´–ï –§–†–£–ö–¢–û–í (–≠–ú–û–î–ó–ò –ò URL) ===
        const FRUITS_DATA = [
            { name: 'apple', emoji: 'üçé' },
            { name: 'banana', emoji: 'üçå' },
            { name: 'cherry', emoji: 'üçí' },
            { name: 'strawberry', emoji: 'üçì' }
        ];

        function getFruitHtml(fruitName) {
            const url = imageInputs[fruitName].value;
            const fruit = FRUITS_DATA.find(f => f.name === fruitName);

            if (url) {
                // –ï—Å–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω URL, –∏—Å–ø–æ–ª—å–∑—É–µ–º <img>
                return `<img src="${url}" alt="${fruit.emoji}" onerror="this.outerHTML='${fruit.emoji}'" class="w-12 h-12 object-contain" style="font-size: 3rem;">`;
            } else {
                // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç–º–æ–¥–∑–∏
                return fruit.emoji;
            }
        }

        // === –î–ê–ù–ù–´–ï –í–ò–ö–¢–û–†–ò–ù–´ (20 –≤–æ–ø—Ä–æ—Å–æ–≤) ===
        const QUIZ_QUESTIONS = [
            { q: "He usually ___ football on Sundays.", opts: ["is playing", "plays"], ans: "plays" },
            { q: "Look! Jane ___ a new dress today.", opts: ["wears", "is wearing"], ans: "is wearing" },
            { q: "They ___ to the cinema very often.", opts: ["don't go", "aren't going"], ans: "don't go" },
            { q: "I ___ a book now.", opts: ["read", "am reading"], ans: "am reading" },
            { q: "What ___ tomorrow evening?", opts: ["do you do", "are you doing"], ans: "are you doing" },
            { q: "She never ___ her keys.", opts: ["is forgetting", "forgets"], ans: "forgets" },
            { q: "We ___ lunch at the moment.", opts: ["have", "are having"], ans: "are having" },
            { q: "My parents ___ in London.", opts: ["are living", "live"], ans: "live" },
            { q: "Listen! Someone ___ at the door.", opts: ["knocks", "is knocking"], ans: "is knocking" },
            { q: "He always ___ his mother with chores.", opts: ["is always helping", "helps"], ans: "helps" },
            { q: "They ___ their grandmother next week.", opts: ["are visiting", "visit"], ans: "are visiting" },
            { q: "The sun ___ in the East.", opts: ["is rising", "rises"], ans: "rises" },
            { q: "Why ___ ?", opts: ["do you cry", "are you crying"], ans: "are you crying" },
            { q: "Mary ___ English every day.", opts: ["is teaching", "teaches"], ans: "teaches" },
            { q: "I ___ an email to my boss right now.", opts: ["write", "am writing"], ans: "am writing" },
            { q: "The train ___ at 6 PM.", opts: ["is leaving", "leaves"], ans: "leaves" },
            { q: "Be quiet! The baby ___.", opts: ["sleeps", "is sleeping"], ans: "is sleeping" },
            { q: "Where ___ ?", opts: ["are you working", "do you work"], ans: "do you work" },
            { q: "Water ___ at 100 degrees Celsius.", opts: ["is boiling", "boils"], ans: "boils" },
            { q: "I ___ John tonight.", opts: ["am meeting", "meet"], ans: "am meeting" }
        ];

        // === –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ===

        function updateDisplay() {
            scoreDisplay.textContent = `–°—á–µ—Ç: ${score}`;
            livesDisplay.textContent = `–ñ–∏–∑–Ω–∏: ${'‚ù§Ô∏è'.repeat(lives)}`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è
            if (score >= 50 && !isGameOver) {
                isGameOver = true;
                showWinModal();
                cancelAnimationFrame(animationFrameId);
            }
        }

        function createFruit() {
            const fruitType = FRUITS_DATA[Math.floor(Math.random() * FRUITS_DATA.length)];
            const fruitEl = document.createElement('div');
            fruitEl.className = 'fruit';
            fruitEl.innerHTML = getFruitHtml(fruitType.name);

            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∏–∫—Å–µ–ª—è—Ö (–æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ GAME_WIDTH)
            const fruitSize = 48 * scaleFactor; // –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä 48px
            const x = Math.random() * (GAME_WIDTH * scaleFactor - fruitSize);
            
            fruitEl.style.left = `${x}px`;
            fruitEl.style.top = `${-fruitSize}px`; // –°–≤–µ—Ä—Ö—É, –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
            fruitEl.dataset.x = x / scaleFactor;
            fruitEl.dataset.y = -fruitSize / scaleFactor;
            fruitEl.dataset.speed = FALL_SPEED_MIN + Math.random() * (FALL_SPEED_MAX - FALL_SPEED_MIN);
            fruitEl.dataset.size = fruitSize / scaleFactor;

            gameArea.appendChild(fruitEl);
            fruits.push(fruitEl);
        }

        function updateGame(timestamp) {
            if (isGamePaused || isGameOver) return;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
            currentWidth = gameArea.offsetWidth;
            currentHeight = gameArea.offsetHeight;
            scaleFactor = currentWidth / GAME_WIDTH;
            const basketHeight = 80;

            // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—Ä—É–∫—Ç–æ–≤
            if (timestamp - lastFruitTime > FRUIT_SPAWN_RATE) {
                createFruit();
                lastFruitTime = timestamp;
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä—É–∫—Ç–æ–≤
            fruits = fruits.filter(fruitEl => {
                let y = parseFloat(fruitEl.dataset.y);
                const speed = parseFloat(fruitEl.dataset.speed);
                const size = parseFloat(fruitEl.dataset.size);
                
                y += speed;
                fruitEl.dataset.y = y;

                // –ü–µ—Ä–µ—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å —É—á–µ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è)
                fruitEl.style.top = `${y * scaleFactor}px`;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è (–£–ª–∞–≤–ª–∏–≤–∞–Ω–∏–µ)
                const fruitX = parseFloat(fruitEl.dataset.x) + size / 2;
                const fruitYBottom = y + size;

                const basketScaledWidth = 120 * scaleFactor;
                const basketScaledHeight = basketHeight * scaleFactor;
                const basketXScaled = basketX * scaleFactor;

                const basketLeft = basketXScaled;
                const basketRight = basketXScaled + basketScaledWidth;
                const catchLineY = currentHeight - basketScaledHeight;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ–ø–∞–ª –ª–∏ —Ñ—Ä—É–∫—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É
                if (fruitYBottom * scaleFactor >= catchLineY && fruitYBottom * scaleFactor <= currentHeight && 
                    fruitX * scaleFactor > basketLeft && fruitX * scaleFactor < basketRight) {
                    
                    // –ü–æ–π–º–∞–Ω–æ!
                    score++;
                    updateDisplay();
                    gameArea.removeChild(fruitEl);

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
                    if (score > 0 && score % 5 === 0 && currentQuizIndex < QUIZ_QUESTIONS.length) {
                        showQuiz();
                    }
                    
                    return false; // –£–¥–∞–ª–∏—Ç—å —Ñ—Ä—É–∫—Ç
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø—Ä–æ–ø—É—â–µ–Ω –ª–∏ —Ñ—Ä—É–∫—Ç
                if (fruitYBottom * scaleFactor > currentHeight) {
                    lives--;
                    updateDisplay();
                    gameArea.removeChild(fruitEl);

                    if (lives <= 0) {
                        isGameOver = true;
                        showLoseModal();
                        cancelAnimationFrame(animationFrameId);
                    }
                    
                    return false; // –£–¥–∞–ª–∏—Ç—å —Ñ—Ä—É–∫—Ç
                }

                return true; // –û—Å—Ç–∞–≤–∏—Ç—å —Ñ—Ä—É–∫—Ç
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
            basket.style.left = `${basketX * scaleFactor}px`;
            basket.style.width = `${120 * scaleFactor}px`;
            basket.style.height = `${basketHeight * scaleFactor}px`;

            animationFrameId = requestAnimationFrame(updateGame);
        }

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–†–ó–ò–ù–û–ô ===

        function moveBasket(deltaX) {
            const basketWidth = 120; // –®–∏—Ä–∏–Ω–∞ –∫–æ—Ä–∑–∏–Ω—ã –≤ –±–∞–∑–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–æ—Ä–∑–∏–Ω—ã –≤ –±–∞–∑–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö GAME_WIDTH
            basketX = Math.max(0, Math.min(GAME_WIDTH - basketWidth, basketX + deltaX));
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            if (isGamePaused || isGameOver) return;
            if (e.key === 'ArrowLeft' || e.key === 'a') {
                moveBasket(-BASKET_SPEED);
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                moveBasket(BASKET_SPEED);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º—ã—à–∏/–∫–∞—Å–∞–Ω–∏—è
        gameArea.addEventListener('mousemove', (e) => {
            if (isGamePaused || isGameOver) return;
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é X –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
            const rect = gameArea.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤ –±–∞–∑–æ–≤—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–æ—Ä–∑–∏–Ω—É
            const targetX = (mouseX / scaleFactor) - 60; // 60 - –ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã –∫–æ—Ä–∑–∏–Ω—ã (120/2)
            
            moveBasket(targetX - basketX);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞—Å–∞–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        gameArea.addEventListener('touchmove', (e) => {
            if (isGamePaused || isGameOver) return;
            if (e.touches.length > 0) {
                const rect = gameArea.getBoundingClientRect();
                const touchX = e.touches[0].clientX - rect.left;
                
                const targetX = (touchX / scaleFactor) - 60;
                moveBasket(targetX - basketX);
                e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É
            }
        });

        // === –§–£–ù–ö–¶–ò–ò –í–ò–ö–¢–û–†–ò–ù–´ ===

        function showQuiz() {
            if (currentQuizIndex >= QUIZ_QUESTIONS.length) return;

            isGamePaused = true;
            const quiz = QUIZ_QUESTIONS[currentQuizIndex];

            quizQuestionEl.textContent = quiz.q.replace(/___/, '(...)');
            quizOptionsEl.innerHTML = '';

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞
            const shuffledOptions = [...quiz.opts].sort(() => Math.random() - 0.5);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'quiz-button w-full bg-primary-blue text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 ease-in-out';
                button.onclick = () => handleQuizAnswer(option, quiz.ans);
                quizOptionsEl.appendChild(button);
            });

            quizModal.classList.remove('hidden');
        }

        function handleQuizAnswer(selected, correct) {
            quizModal.classList.add('hidden');
            currentQuizIndex++;
            isGamePaused = false;

            if (selected === correct) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä—É
                // –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã - —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Å–æ–ª—å)
                console.log("–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.");
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: –°–Ω–∏–º–∞–µ–º 5 –æ—á–∫–æ–≤
                score = Math.max(0, score - 5);
                updateDisplay();
                // –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
                console.log(`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –í—ã —Ç–µ—Ä—è–µ—Ç–µ 5 –æ—á–∫–æ–≤. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correct}`);
                
                // –ï—Å–ª–∏ —Å—á–µ—Ç –ø–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ —Å—Ç–∞–ª –∫—Ä–∞—Ç–µ–Ω 5, –Ω–æ –º–µ–Ω—å—à–µ 50, –∏ –µ—Å—Ç—å –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã,
                // –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É. (–•–æ—Ç—è –ø–æ –ª–æ–≥–∏–∫–µ, –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã–ª –ø–æ—è–≤–∏—Ç—å—Å—è
                // –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫—Ä–∞—Ç–Ω–æ–º 5, –Ω–æ —ç—Ç–æ –∑–∞—â–∏—Ç–∏—Ç –æ—Ç –ø—Ä–æ–ø—É—Å–∫–∞)
                if (score > 0 && score % 5 === 0 && currentQuizIndex < QUIZ_QUESTIONS.length) {
                     // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –∏–ª–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ—Å–ª–µ –≤–æ–∑–º–æ–∂–Ω–æ–π –ø–æ—Ç–µ—Ä–∏ –æ—á–∫–æ–≤
            if (score >= 50 && !isGameOver) {
                isGameOver = true;
                showWinModal();
                cancelAnimationFrame(animationFrameId);
            } else {
                 // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä—É, –µ—Å–ª–∏ –Ω–µ –ø–æ–±–µ–¥–∞
                 animationFrameId = requestAnimationFrame(updateGame);
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –ú–û–î–ê–õ–¨–ù–´–• –û–ö–û–ù –ö–û–ù–¶–ê –ò–ì–†–´ ===

        function showWinModal() {
            modalTitle.textContent = "–ü–û–ë–ï–î–ê! üéâ";
            modalTitle.classList.remove('text-red-600');
            modalTitle.classList.add('text-yellow-600');
            modalMessage.textContent = "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞–±—Ä–∞–ª–∏ 50 –æ—á–∫–æ–≤ –∏ –ø—Ä–æ—à–ª–∏ –≤—Å–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã!";
            winLoseModal.classList.remove('hidden');
            createFireworks();
        }

        function showLoseModal() {
            modalTitle.textContent = "–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê üò¢";
            modalTitle.classList.remove('text-yellow-600');
            modalTitle.classList.add('text-red-600');
            modalMessage.textContent = `–í—ã –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ—Ä—É–∫—Ç–æ–≤. –í–∞—à –∏—Ç–æ–≥–æ–≤—ã–π —Å—á–µ—Ç: ${score}.`;
            winLoseModal.classList.remove('hidden');
        }

        function createFireworks() {
            const count = 30;
            for (let i = 0; i < count; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 80% –æ–∫–Ω–∞
                firework.style.left = `${10 + Math.random() * 80}%`;
                firework.style.top = `${10 + Math.random() * 80}%`;
                // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                firework.style.animationDelay = `${Math.random() * 0.5}s`;
                winLoseModal.appendChild(firework);
            }
            // –£–¥–∞–ª—è–µ–º —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
            setTimeout(() => {
                document.querySelectorAll('.firework').forEach(f => f.remove());
            }, 1000);
        }

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ===

        function initGame() {
            // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ñ—Ä—É–∫—Ç—ã –∏ —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏
            fruits.forEach(f => gameArea.removeChild(f));
            fruits = [];
            document.querySelectorAll('.firework').forEach(f => f.remove());

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            score = 0;
            lives = 3;
            isGamePaused = false;
            isGameOver = false;
            currentQuizIndex = 0;
            
            // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
            basketX = GAME_WIDTH / 2 - 60; 

            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            quizModal.classList.add('hidden');
            winLoseModal.classList.add('hidden');

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏—Å–ø–ª–µ–π
            updateDisplay();

            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            animationFrameId = requestAnimationFrame(updateGame);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
        restartButton.addEventListener('click', initGame);

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function () {
            // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
            currentWidth = gameArea.offsetWidth;
            currentHeight = gameArea.offsetHeight;
            scaleFactor = currentWidth / GAME_WIDTH;

            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            initGame();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
             // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã, –Ω–æ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É
             currentWidth = gameArea.offsetWidth;
             currentHeight = gameArea.offsetHeight;
             scaleFactor = currentWidth / GAME_WIDTH;
             
             // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–æ—Ä–∑–∏–Ω—ã —Å –Ω–æ–≤—ã–º –º–∞—Å—à—Ç–∞–±–æ–º
             basket.style.left = `${basketX * scaleFactor}px`;
             basket.style.width = `${120 * scaleFactor}px`;
             basket.style.height = `${80 * scaleFactor}px`;
        });
    </script>
</body>
</html>
